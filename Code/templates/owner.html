<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <!-- Auto-refresh page every 45 seconds -->
  <meta http-equiv="refresh" content="45">
  <!-- Mobile friendly -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Owner Dashboard - Arrival Bistro N Cafe</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <style>
    /* Set a custom background using your image iii.jpg */
    body {
      background: url('{{ url_for("static", filename="images/iii.jpg") }}') no-repeat center center fixed;
      background-size: cover;
    }
    .owner-container {
      max-width: 1200px;
      margin: 30px auto;
      background: rgba(255, 255, 255, 0.95); /* slight transparency for readability */
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .owner-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    .owner-header h1 {
      margin: 0;
      font-size: 2rem;
    }
    .header-links {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
    .header-links a {
      padding: 10px 15px;
      background-color: #ff4500;
      color: #fff;
      text-decoration: none;
      border-radius: 5px;
      font-weight: bold;
      transition: background 0.3s ease;
    }
    .header-links a:hover {
      background-color: #e03e00;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }
    table, th, td {
      border: 1px solid #ddd;
    }
    th, td {
      padding: 12px;
      text-align: center;
    }
    th {
      background: #f4f4f4;
    }
    .action-btn {
      margin: 2px;
    }
    .analytics-container {
      margin-top: 30px;
      text-align: center;
    }
    .chart-container {
      width: 30%;
      display: inline-block;
      vertical-align: top;
      margin: 10px;
    }
  </style>
</head>
<body>
  <div class="owner-container">
    <div class="owner-header">
      <h1>Owner Dashboard</h1>
      <div class="header-links">
        <a href="{{ url_for('pricing_availability') }}">Pricing & Availability</a>
        <a href="{{ url_for('owner_reviews') }}">View Reviews</a>
        <a href="{{ url_for('owner_logout') }}">Logout</a>
      </div>
    </div>
    
    <!-- Display Total Sales -->
    <h2>Total Sales: ₹{{ stats.total_revenue }}</h2>
    
    <!-- Orders Table -->
    {% for date, day_data in orders.items() %}
      <h2>Orders for {{ date }}</h2>
      <table>
        <thead>
          <tr>
            <th>Completed</th>
            <th>Order #</th>
            <th>Items</th>
            <th>Total (₹)</th>
            <th>Payment Method</th>
            <th>Status</th>
            <th>Order Time</th>
            <th>Table</th>
            <th>Payment Received</th>
            <th>Delete</th>
          </tr>
        </thead>
        <tbody>
          {% for order in day_data['orders'] %}
            <tr>
              <td>
                {% if order['status'] not in ['completed', 'payment complete'] %}
                  <form action="{{ url_for('complete_order') }}" method="POST">
                    <input type="hidden" name="date" value="{{ date }}">
                    <input type="hidden" name="orderNumber" value="{{ order['orderNumber'] }}">
                    <input type="checkbox" name="complete" onchange="this.form.submit()">
                  </form>
                {% else %}
                  &#10003;
                {% endif %}
              </td>
              <td>{{ order['orderNumber'] }}</td>
              <td>
                <ul>
                  {% for item in order['order_items'] %}
                    <li>{{ item['quantity'] }} x {{ item['name'] }} (₹{{ item['price'] }})</li>
                  {% endfor %}
                </ul>
              </td>
              <td>{{ order['total'] }}</td>
              <td>{{ order['paymentMethod'] }}</td>
              <td>{{ order['status'] }}</td>
              <td>{{ order['orderTime'] }}</td>
              <td>
                {% if order.dine_option == 'eat_in' %}
                  {{ order.table_number }}
                {% else %}
                  N/A
                {% endif %}
              </td>
              <td>
  		{% if order.get('payment_confirmed') %}
    		&#10003;
  		{% else %}
    		<form action="{{ url_for('confirm_payment_received') }}" method="POST">
      		  <input type="hidden" name="date" value="{{ date }}">
      		  <input type="hidden" name="orderNumber" value="{{ order['orderNumber'] }}">
      		  <label class="checkBox transition">
        	  <input type="checkbox" name="payment_confirmed" onchange="this.form.submit()">
        	<div></div>
      		</label>
    		</form>
  		{% endif %}
	      </td>
              <td>
                <form action="{{ url_for('delete_order') }}" method="POST" onsubmit="return confirm('Are you sure you want to delete this order?');">
                  <input type="hidden" name="date" value="{{ date }}">
                  <input type="hidden" name="orderNumber" value="{{ order['orderNumber'] }}">
                  <button type="submit" class="btn action-btn">Delete</button>
                </form>
              </td>
	      <td>
  	<p><strong>{{ order.name }}</strong></p>
  {% if order.size and order.size != "Regular" %}
    	<p>Option: {{ order.size|capitalize }}</p>
  {% endif %}
  	<p>Qty: {{ order.quantity }}</p>
  	<p>Price: ₹{{ order.price }} each</p>
  	<p>Total: ₹{{ order.total }}</p>
	    </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% endfor %}
    
    <!-- Analytics Section -->
    <div class="analytics-container">
      <h2>Analytics</h2>
      <div class="chart-container">
        <canvas id="revenuePieChart"></canvas>
      </div>
      <div class="chart-container">
        <canvas id="revenueBarChart"></canvas>
      </div>
      <div class="chart-container">
        <canvas id="dishCountBarChart"></canvas>
      </div>
      <div class="chart-container" style="width:45%;">
        <canvas id="dailyRevenueChart"></canvas>
      </div>
    </div>
    
    <div style="text-align: center; margin-top: 20px;">
      <p class="license">FSSAI License No.: {{ fssai }}</p>
    </div>
  </div>
  
  <!-- Include Chart.js from CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // Revenue by Category Pie Chart
    const categoryRevenue = {{ stats.category_revenue | tojson }};
    const revenueLabels = Object.keys(categoryRevenue);
    const revenueData = Object.values(categoryRevenue);
    const ctxPie = document.getElementById('revenuePieChart').getContext('2d');
    new Chart(ctxPie, {
      type: 'pie',
      data: {
        labels: revenueLabels,
        datasets: [{
          data: revenueData,
          backgroundColor: ['#ff6384','#36a2eb','#ffcd56','#4bc0c0','#9966ff','#ff9f40']
        }]
      },
      options: {
        title: {
          display: true,
          text: 'Revenue by Category'
        }
      }
    });
    
    // Revenue by Category Bar Chart
    const ctxBarRev = document.getElementById('revenueBarChart').getContext('2d');
    new Chart(ctxBarRev, {
      type: 'bar',
      data: {
        labels: revenueLabels,
        datasets: [{
          label: 'Revenue (₹)',
          data: revenueData,
          backgroundColor: 'rgba(255, 99, 132, 0.6)',
          borderColor: 'rgba(255,99,132,1)',
          borderWidth: 1
        }]
      },
      options: {
        title: {
          display: true,
          text: 'Revenue by Category'
        },
        scales: {
          y: { beginAtZero: true }
        }
      }
    });
    
    // Dish Count by Category Bar Chart
    const categoryDishCount = {{ stats.category_dish_count | tojson }};
    const dishCountLabels = Object.keys(categoryDishCount);
    const dishCountData = Object.values(categoryDishCount);
    const ctxBarDish = document.getElementById('dishCountBarChart').getContext('2d');
    new Chart(ctxBarDish, {
      type: 'bar',
      data: {
        labels: dishCountLabels,
        datasets: [{
          label: 'Dishes Sold',
          data: dishCountData,
          backgroundColor: 'rgba(54, 162, 235, 0.6)',
          borderColor: 'rgba(54, 162, 235, 1)',
          borderWidth: 1
        }]
      },
      options: {
        title: {
          display: true,
          text: 'Dish Sales by Category'
        },
        scales: {
          y: { beginAtZero: true }
        }
      }
    });
    
    // Daily Revenue Histogram
    const dailyRevenue = {{ stats.daily_revenue | tojson }};
    const dailyLabels = Object.keys(dailyRevenue);
    const dailyData = Object.values(dailyRevenue);
    const ctxDaily = document.getElementById('dailyRevenueChart').getContext('2d');
    new Chart(ctxDaily, {
      type: 'bar',
      data: {
        labels: dailyLabels,
        datasets: [{
          label: 'Daily Revenue (₹)',
          data: dailyData,
          backgroundColor: 'rgba(75, 192, 192, 0.6)',
          borderColor: 'rgba(75, 192, 192, 1)',
          borderWidth: 1
        }]
      },
      options: {
        title: {
          display: true,
          text: 'Daily Revenue'
        },
        scales: {
          y: { beginAtZero: true }
        }
      }
    });
  </script>
</body>
</html>
